import os
import sys
#MONOMER
line_no = 2                        # line no. of coordinate file
file_no = 1                        # numbering for the new files for monomers
h = open('/home/csabu/PROJECT_IITKGP/Coordinates/entry.txt','r')      #user will have to name the file entry.txt
l = h.readlines()                  #list containing lines of entry.txt
temp_filename = l[len(l)-1]                                 # at present name of the file includes last character \n
coord_filename = temp_filename[:len(temp_filename)-1]       # string slicing : to remove \n
f = open('/home/csabu/PROJECT_IITKGP/Coordinates/' + coord_filename, 'r')
lines = f.readlines()
f.close()
tot_atoms = int(lines[0])                                  # total no. of atoms as mentioned in the first line of
                                                           # coordinate file
length = len(lines) - 2                                    # calculating total no. of atoms by counting
                                                           # the no. of lines corresponding to atom's coordinate
#CHECKING COORDINATE FILE
if tot_atoms != length:                                    # if the no. of atoms in 1st line of file is not equal to
    print('****ERROR WHILE ENTERING COORDINATES****')      # the no. of coordinates given
    sys.exit()                                             # code execution stops
h.close()
n = int(l[0])                      # no.of fragments
os.mkdir('/home/csabu/PycharmProjects/clusters/PythonProjects/B1')
for i in range(1,n+1):
    n_atoms = int(l[i])            # no. of atoms in a fragment
    x = line_no
    name = str(file_no) + '.xyz'
    g = open('/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + name, 'w+')
    #g.write(l[i])
    #g.write('\n')
    g.close()
    for j in range(x,x+n_atoms):
        f = open('/home/csabu/PROJECT_IITKGP/Coordinates/' + coord_filename,'r')
        lines = f.readlines()
        f.close()
        g = open('/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + name, 'a')
        g.write(lines[j])
        g.close()
        line_no = j + 1

    file_no+=1

#DIMERS
os.mkdir('/home/csabu/PycharmProjects/clusters/PythonProjects/B2')
for p in range(1,n+1):
    for q in range(p+1,n+1):
        file_1 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(p)+'.xyz'
        file_2 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(q)+'.xyz'
        filenames = [file_1, file_2]
        with open( '/home/csabu/PycharmProjects/clusters/PythonProjects/B2/'+ str(p)+str(q)+'.xyz', 'w') as outfile:
            for fname in filenames:
                with open(fname) as infile:
                    outfile.write(infile.read())
                infile.close()
        outfile.close()

#TRIMERS
if n<=2:                                               # if the cluster contains only 2 fragments
    sys.exit()                                         # code execution stops
os.mkdir('/home/csabu/PycharmProjects/clusters/PythonProjects/B3')
for i in range (1,n+1):
    for j in range (i+1,n+1):
        for k in range (j+1,n+1):
            file_1 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(i) + '.xyz'
            file_2 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(j) + '.xyz'
            file_3 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(k) + '.xyz'
            filenames = [file_1, file_2, file_3]
            with open('/home/csabu/PycharmProjects/clusters/PythonProjects/B3/' + str(i) + str(j) + str(k) + '.xyz', 'w') as outfile:
                for fname in filenames:
                    with open(fname) as infile:
                        outfile.write(infile.read())
                    infile.close()
            outfile.close()
#print('#####')
#TETRAMERS
if n<=3:                                              # if the cluster contains only 3 fragments
    sys.exit()                                        # code execution stops
os.mkdir('/home/csabu/PycharmProjects/clusters/PythonProjects/B4')
for p in range(1,n+1):
    for q in range(p+1,n+1):
        for r in range(q+1,n+1):
            for s in range(r+1,n+1):
                file_1 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(p) + '.xyz'
                file_2 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(q) + '.xyz'
                file_3 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(r) + '.xyz'
                file_4 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(s) + '.xyz'
                filenames = [file_1, file_2, file_3, file_4]
                with open('/home/csabu/PycharmProjects/clusters/PythonProjects/B4/' + str(p) + str(q) + str(r) + str(s) + '.xyz', 'w') as outfile:
                    for fname in filenames:
                        with open(fname) as infile:
                            outfile.write(infile.read())
                        infile.close()
                outfile.close()
#print('######')
# formatting TETRAMERS

for p in range(1,n+1):
    for q in range(p+1,n+1):
        for r in range(q+1,n+1):
            for s in range(r+1,n+1):
                print('**')
                file_1 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(p) + '.xyz'
                file_2 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(q) + '.xyz'
                file_3 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(r) + '.xyz'
                file_4 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(s) + '.xyz'
                filenames = [file_1, file_2, file_3, file_4]
                name_4 = str(p) + str(q) + str(r) + str(s) + '.xyz'
                f = open('/home/csabu/PycharmProjects/clusters/PythonProjects/B4/' + name_4, 'r')
                list_4 = f.readlines()
                lines_in_4 = len(list_4)
                temp4_l = [lines_in_4]
                f.close()
                TEMP = '/home/csabu/PycharmProjects/clusters/PythonProjects/B4/temp4.xyz'
                with open(TEMP, 'w') as file:
                    for l in temp4_l:
                        file.write("%i\n" % l)
                        file.write('\n')
                with open('/home/csabu/PycharmProjects/clusters/PythonProjects/B4/temp4.xyz', 'a') as outfile:
                    for fname in filenames:
                        with open(fname) as infile:
                            outfile.write(infile.read())
                        infile.close()
                outfile.close()
                os.remove('/home/csabu/PycharmProjects/clusters/PythonProjects/B4/' + name_4)
                os.rename('/home/csabu/PycharmProjects/clusters/PythonProjects/B4/temp4.xyz','/home/csabu/PycharmProjects/clusters/PythonProjects/B4/' + name_4)

# formatting TRIMERS

for i in range (1,n+1):
    for j in range (i+1,n+1):
        for k in range (j+1,n+1):
            print('**')
            file_1 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(i) + '.xyz'
            file_2 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(j) + '.xyz'
            file_3 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(k) + '.xyz'
            filenames = [file_1, file_2, file_3]
            name_3 = str(i) + str(j) + str(k) + '.xyz'
            f = open('/home/csabu/PycharmProjects/clusters/PythonProjects/B3/' + name_3, 'r')
            list_3 = f.readlines()
            lines_in_3 = len(list_3)
            temp3_l = [lines_in_3]
            TEMP = '/home/csabu/PycharmProjects/clusters/PythonProjects/B3/temp3.xyz'
            with open(TEMP, 'w') as file:
                for l in temp3_l:
                    file.write("%i\n" % l)
                    file.write('\n')
            with open(TEMP, 'a') as outfile:
                for fname in filenames:
                    with open(fname) as infile:
                        outfile.write(infile.read())
                    infile.close()
            outfile.close()
            os.remove('/home/csabu/PycharmProjects/clusters/PythonProjects/B3/' + name_3)
            os.rename(TEMP ,'/home/csabu/PycharmProjects/clusters/PythonProjects/B3/' + name_3)

# formatting dimers
for p in range(1,n+1):
    for q in range(p+1,n+1):
        print('**')
        file_1 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(p)+'.xyz'
        file_2 = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + str(q)+'.xyz'
        filenames = [file_1, file_2]
        name_2 = str(p)+str(q)+'.xyz'
        f = open('/home/csabu/PycharmProjects/clusters/PythonProjects/B2/' + name_2, 'r')
        list_2 = f.readlines()
        lines_in_2 = len(list_2)
        temp2_l = [lines_in_2]
        TEMP = '/home/csabu/PycharmProjects/clusters/PythonProjects/B2/temp2.xyz'
        with open(TEMP, 'w') as file:
                for l in temp2_l:
                    file.write("%i\n" % l)
                    file.write('\n')

        with open( TEMP , 'a') as outfile:
            for fname in filenames:
                with open(fname) as infile:
                    outfile.write(infile.read())
                infile.close()
        outfile.close()
        os.remove('/home/csabu/PycharmProjects/clusters/PythonProjects/B2/' + name_2)
        os.rename(TEMP, '/home/csabu/PycharmProjects/clusters/PythonProjects/B2/' + name_2)

# formatting monomers
for i in range(1,n+1):
    print('**')
    name_1 = str(i) + '.xyz'
    f = open('/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + name_1, 'r')
    list_1 = f.readlines()
    lines_in_1 = len(list_1)
    temp1_l = [lines_in_1]
    TEMP = '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/temp1.xyz'
    with open(TEMP, 'w') as file:
        for l in temp1_l:
            file.write("%i\n" % l)
            file.write('\n')

    with open(TEMP, 'a') as outfile:
            with open('/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + name_1, 'r') as infile:
                outfile.write(infile.read())
            infile.close()
    outfile.close()
    os.remove('/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + name_1)
    os.rename(TEMP, '/home/csabu/PycharmProjects/clusters/PythonProjects/B1/' + name_1)
